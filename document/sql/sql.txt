create database if not exists ptu_dev_cloud;

use ptu_dev_cloud;

-- auto-generated definition
create table if not exists method_log
(
    id           bigint            not null comment '主键id'
        primary key,
    method_name  varchar(512)      null comment '方法名',
    method_path  varchar(1024)     null comment '方法所在路径',
    params_json  text              null comment '方法入参',
    result_json  text              null comment '方法出参',
    consume_time varchar(16)       null comment '方法运行耗时(单位：秒)',
    pass_flag    tinyint default 1 null comment '方法是否运行成功',
    error_msg    text              null comment '报错信息',
    create_by    bigint            null comment '创建人',
    create_date  datetime          null comment '创建时间',
    update_by    bigint            null comment '更新人',
    update_date  datetime          null comment '更新时间',
    url          varchar(2048)     null comment '请求url'
)
    comment '方法日志';


-- auto-generated definition
create table if not exists table_sequence
(
    id            bigint auto_increment comment '主键id'
        primary key,
    sequence_name varchar(64)      not null comment 'SEQ_表名大写',
    table_id      bigint default 1 not null comment '表主键',
    step          int    default 1 null comment '自增步长',
    version       char(32)         null comment '版本号(乐观锁)',
    create_by     bigint           null comment '创建人',
    create_date   datetime         null comment '创建时间',
    update_by     bigint           null comment '更新人',
    update_date   datetime         null comment '更新时间'
)
    comment '表序列';



insert into table_sequence(sequence_name, create_date) value ('SEQ_METHOD_LOG', sysdate());

create table if not exists user(
    id                      bigint              not null comment '主键id'
        primary key,
    create_by               bigint              null comment '创建人',
    create_date             datetime            null comment '创建时间',
    update_by               bigint              null comment '更新人',
    update_date             datetime            null comment '更新时间',
    status                  tinyint             default true comment '用户状态: 启用(1/true), 禁用(0/false)',
    login_account           varchar(32)         unique key not null comment '登录账号',
    login_password          char(32)            default 'e10adc3949ba59abbe56e057f20f883e' comment '登录密码',
    email                   varchar(64)         null comment '邮箱',
    phone_number            varchar(32)         null comment '手机号',
    user_name               varchar(32)         default '用户' comment '用户名',
    avatar                  varchar(128)        null comment '头像'
) comment '用户表';

insert into table_sequence(sequence_name, create_date) value ('SEQ_USER', sysdate());

create table if not exists permission
(
    id                      bigint                      not null comment '主键id'
        primary key,
    create_by               bigint                      null comment '创建人',
    create_date             datetime                    null comment '创建时间',
    update_by               bigint                      null comment '更新人',
    update_date             datetime                    null comment '更新时间',
    permission_name         varchar(50)                 not null comment '权限名称',
    parent_id               bigint       default 0      null comment '父ID',
    order_num               int          default 0      null comment '显示顺序',
    path                    varchar(200) default ''     null comment '路由地址',
    component               varchar(255)                null comment '组件路径',
    permission_type         char                        null comment '权限类型（M菜单 F按钮）',
    visible                 tinyint      default true   null comment '显示状态:显示(1/true), 隐藏(0/false)',
    status                  tinyint      default true   null comment '权限状态:启用(1/true), 禁用(0/false)',
    perms                   varchar(100)                null comment '权限表达式',
    icon                    varchar(100) default '#'    null comment '菜单图标',
    remark                  varchar(500) default ''     null comment '备注'
) comment '权限表';

insert into table_sequence(sequence_name, create_date) value ('SEQ_PERMISSION', sysdate());

create table if not exists role(
    id                      bigint                      not null comment '主键id'
        primary key,
    create_by               bigint                      null comment '创建人',
    create_date             datetime                    null comment '创建时间',
    update_by               bigint                      null comment '更新人',
    update_date             datetime                    null comment '更新时间',
    role_name               varchar(30)                 not null comment '角色名称',
    order_num               int          default 0      not null comment '显示顺序',
    status                  tinyint      default true   not null comment '角色状态:启用(1/true), 禁用(0/false)'
) comment '角色表';

insert into table_sequence(sequence_name, create_date) value ('SEQ_ROLE', sysdate());

create table if not exists user_role(
    id              bigint              not null comment '主键id'
        primary key,
    create_by       bigint              null comment '创建人',
    create_date     datetime            null comment '创建时间',
    update_by       bigint              null comment '更新人',
    update_date     datetime            null comment '更新时间',
    user_id         bigint              not null comment '用户id',
    role_id         bigint              not null comment '角色id'
) comment '用户和角色关联表';

insert into table_sequence(sequence_name, create_date) value ('SEQ_USER_ROLE', sysdate());

create table if not exists role_permission(
    id              bigint              not null comment '主键id'
        primary key,
    create_by       bigint              null comment '创建人',
    create_date     datetime            null comment '创建时间',
    update_by       bigint              null comment '更新人',
    update_date     datetime            null comment '更新时间',
    role_id         bigint              not null comment '角色id',
    permission_id   bigint              not null comment '权限id'
) comment '角色权限关联表';

insert into table_sequence(sequence_name, create_date) value ('SEQ_ROLE_PERMISSION', sysdate());

update table_sequence set table_id = '200' where sequence_name = 'SEQ_PERMISSION';

alter table user modify login_password varchar(128) null comment '登录密码';

alter table permission change permission_name name varchar(50) not null comment '权限名称';

alter table permission alter column icon set default null;

alter table permission change visible render_menu tinyint default 1 null comment '显示状态:显示(1/true), 隐藏(0/false)';

alter table permission change perms permission varchar(100) null comment '权限表达式';

alter table permission
	add target varchar(16) default '_self' null comment '''_self''在当前页面打开，''_blank''打开新页面';

alter table permission
	add title varchar(64) null comment '标题';


INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (10, null, null, null, null, 'workplace', 0, 10, '/workplace', '@/pages/workplace', 'M', 1, 1, null, 'DashboardOutlined', '', '_self', '工作台', null);
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (20, null, null, null, null, 'table', 0, 20, '/table', '@/pages/table', 'M', 1, 1, null, 'TableOutlined', '', '_self', '表格', null);
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (30, null, null, 100, '2023-11-29 18:01:19', 'personal', 0, 30, '/personal', '@/pages/personal', 'M', 1, 1, null, 'UserOutlined', '', '_self', '个人中心', null);
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (40, null, null, null, null, 'system', 0, 40, '/system', '@/components/layout/BlankView.vue', 'M', 1, 1, null, 'SettingOutlined', '', '_self', '系统配置', null);
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (50, null, null, null, null, 'menu', 40, 10, '/system/menu', '@/pages/system/menu', 'M', 1, 1, null, null, '', '_self', '菜单管理', 'system');
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (60, null, null, 100, '2023-12-01 09:24:22', 'user', 40, 20, '/system/user', '@/pages/system/user', 'M', 1, 1, null, null, '', '_self', '用户管理', 'system');
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (102, 0, '2023-11-29 22:29:57', 100, '2023-11-29 22:30:16', 'methodLog', 40, 1, '/system/methodLog', '@/pages/system/methodLog', 'M', 1, 1, null, null, '', '_self', '接口日志', 'system');
INSERT INTO permission (id, create_by, create_date, update_by, update_date, name, parent_id, order_num, path, component, permission_type, render_menu, status, permission, icon, remark, target, title, parent) VALUES (103, 0, '2023-12-11 09:41:39', 100, '2023-12-24 17:01:14', 'role', 40, 30, '/system/role', '@/pages/system/role', 'M', 1, 1, null, null, '', '_self', '角色管理', 'system');


alter table permission
	add parent varchar(255) default null null comment '父组件名称';

update permission set parent = 'system' where parent_id = '40';

update permission set icon = 'UserOutlined' where id = 30;

update permission set component = '@/pages/system/menu' where id = 50;

create unique index permission_name_uindex
	on permission (name);

INSERT INTO user (id, create_by, create_date, update_by, update_date, status, login_account, login_password, email, phone_number, user_name, avatar) VALUES (1, 0, '2023-11-25 10:52:43', null, null, 1, 'admin', '$2a$10$sOloiDz8RJ.w4Bh1.1EuOOfLixsrRvou1GijgLUwnxhsFIqFM.cBO', '', '', '用户admin', null);

update table_sequence set table_id = 2 where sequence_name = 'SEQ_USER';


